<!DOCTYPE html>
<html ng-app="todoapp">
  <head>
      <meta charset="UTF-8">
  </head>
  <script src="build/angular.js"></script>
  <script src="build/angular-resource.js"></script>
  <body ng-controller="TodoCtrl as todo">
    TODO:
    <div ng-repeat="t in todo.items">
      {{t.body}} - <span ng-click="todo.toggle($index)">{{t.completed}} </span>
    </div>
    <form>
    <input type="text" ng-model="todo.newTodoBody"> </input>
    <button ng-click="todo.add()">Add</button>
    </form>
    <script>
      var todoapp = new angular.module("todoapp", ["ngResource"]);

      todoapp.controller("TodoCtrl", function($scope, $resource) {
        var Todo = $resource("/todo.json/:id", {id: '@id'}, {})
        var todoCtrl = this
        todoCtrl.items = #{.}# // golang template insert

        todoCtrl.list = function(index) {
          Todo.query( 
            function(data) { // callback
              todoCtrl.items = data
          });
        }

        if (!todoCtrl.items) { // if list not there, query server
          todoCtrl.list();
        }

        todoCtrl.get = function(index) {
          if (!todoCtrl.items[index]) {
            return
          }
          Todo.get({id: todoCtrl.items[index].id}, 
            function(data) {
              todoCtrl.items[index] = data
          });
        }

        todoCtrl.remove = function(index) {

        }

        todoCtrl.add = function() {
          var item = new Todo()
          item.body = todoCtrl.newTodoBody
          item.completed = false
          item.$save(function(data) {
            console.log(data)
            todoCtrl.items.push(data)
          });
          todoCtrl.newTodoBody = ""
        }

        todoCtrl.toggle = function(index){
          todoCtrl.items[index].completed = !todoCtrl.items[index].completed
          Todo.save(todoCtrl.items[index])
        }
      });
    </script>
  </body>
</html>